<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>兰老师企业级 PCDN 监控面板 — TDesign 工业化重构</title>

<!-- ECharts for ledger -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

<style>
/* ===========================================================================
   视觉 Token 系统（严格按要求）
   - 背景色：#050505
   - 组件背景：#121212B8 (rgba(18,18,18,0.72))
   - 边框：0.5px rgba(255,255,255,0.08)
   - backdrop-filter: saturate(180%) blur(20px)
   =========================================================================== */

/* === Tokens === */
:root{
  --bg-primary: #050505;
  --component-bg: #121212b8;
  --component-bg-2: rgba(18,18,18,0.60);
  --border-weak: rgba(255,255,255,0.08);
  --text-primary: rgba(230,240,248,0.98);
  --text-secondary: rgba(159,176,198,0.92);
  --text-muted: rgba(127,147,166,0.85);
  --muted-2: rgba(127,147,166,0.6);
  --accent-1: #2dd4bf;
  --accent-2: #60a5fa;
  --accent-3: #a78bfa;
  --danger: #ff6b6b;
  --success: #34d399;
  --radius-lg: 14px;
  --radius-md: 10px;
  --radius-sm: 8px;
  --space-xs: 6px;
  --space-sm: 10px;
  --space-md: 14px;
  --space-lg: 20px;
  --max-width: 1400px;
  --font-base: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --bezier: cubic-bezier(.2,0,0,1);
}

/* === Global reset / base layout === */
*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; padding:0; font-family:var(--font-base); background:var(--bg-primary); color:var(--text-primary); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
a{ color:inherit; text-decoration:none; }

.container {
  width:100%;
  max-width:var(--max-width);
  margin:20px auto;
  display:grid;
  grid-template-columns: 320px 1fr;
  gap:20px;
  padding:18px;
}

/* common card */
.card {
  background: var(--component-bg);
  border-radius: var(--radius-md);
  padding:14px;
  border: 0.5px solid var(--border-weak);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  color:var(--text-primary);
}

/* minimal */
button, input { font-family:var(--font-base); font-weight:500; }

/* AUTH PORTAL */
.auth-portal {
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.45));
}
.auth-heatmap { position:absolute; inset:0; z-index:9996; pointer-events:none; }
.auth-card {
  width:880px;
  max-width:92%;
  display:flex;
  gap:18px;
  padding:22px;
  border-radius: var(--radius-lg);
  background: linear-gradient(180deg, rgba(18,18,18,0.72), rgba(18,18,18,0.66));
  border:0.5px solid var(--border-weak);
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
  transform-style: preserve-3d;
  will-change: transform;
}
.auth-left { width:300px; display:flex; flex-direction:column; gap:12px; align-items:flex-start; }
.brand-logo { width:72px; height:72px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:20px; color:#032022; background: linear-gradient(135deg,var(--accent-1),var(--accent-2)); box-shadow: 0 10px 36px rgba(45,212,191,0.06); }
.brand-title { font-weight:600; font-size:20px; letter-spacing:0.2px; }
.brand-sub { color:var(--text-muted); font-size:13px; }
.auth-right { flex:1; display:flex; flex-direction:column; gap:12px; }
.form-field { display:flex; flex-direction:column; gap:6px; }
.input {
  padding:12px 14px;
  border-radius:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:0.5px solid var(--border-weak);
  color:var(--text-primary);
  outline:none;
  font-weight:500;
}
.btn-primary {
  padding:10px 14px;
  border-radius:10px;
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  border:0.5px solid var(--border-weak);
  color:#042022;
  font-weight:600;
  cursor:pointer;
}
.btn-ghost {
  padding:10px 12px;
  border-radius:8px;
  background:transparent;
  border:0.5px solid var(--border-weak);
  color:var(--text-secondary);
  font-weight:500;
  cursor:pointer;
}
.tooltip {
  position:absolute;
  background: rgba(10,10,10,0.9);
  border:0.5px solid var(--border-weak);
  padding:8px 10px;
  border-radius:8px;
  color:var(--text-secondary);
  font-size:13px;
  pointer-events:none;
  transform-origin:center top;
  box-shadow: 0 8px 26px rgba(0,0,0,0.6);
  backdrop-filter: saturate(180%) blur(20px);
}

/* MAIN */
.sidebar { height: calc(100vh - 40px); display:flex; flex-direction:column; gap:12px; padding:12px; position:sticky; top:20px; }
.header { display:flex; align-items:center; justify-content:space-between; gap:12px; }
.title { font-size:18px; font-weight:600; }
.subtitle { color:var(--text-secondary); font-size:13px; }
.kpis { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-top:8px; }
.kpi { padding:12px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008)); border:0.5px solid var(--border-weak); }
.kpi .label { color:var(--text-muted); font-size:13px; }
.kpi .value { font-weight:600; font-size:20px; }
.charts { display:grid; grid-template-columns: 1fr 360px; gap:12px; margin-top:12px; }
.chart-card { padding:12px; border-radius:12px; min-height:260px; }
.node-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-top:12px; }
.node-card { padding:12px; border-radius:10px; display:flex; flex-direction:column; gap:8px; border:0.5px solid var(--border-weak); background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01)); }
.log { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:13px; color:#bfeaf0; height:220px; overflow:auto; }
.progress { height:10px; background: rgba(255,255,255,0.03); border-radius:6px; overflow:hidden; }
.progress > i { display:block; height:100%; background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); }
.btn-disabled { opacity:0.45; cursor:not-allowed; color:var(--text-muted); background: linear-gradient(90deg, rgba(255,255,255,0.005), rgba(255,255,255,0.004)); }
.small { font-size:13px; color:var(--text-secondary); }

/* light sweep mask placeholder; animation via JS */
.light-sweep { position:relative; overflow:hidden; }
.light-sweep::after{ content:""; position:absolute; inset:0; pointer-events:none; background: linear-gradient(90deg, rgba(255,255,255,0.00) 0%, rgba(255,255,255,0.06) 45%, rgba(255,255,255,0.00) 70%); mix-blend-mode: overlay; opacity:0.08; transform: translateX(-120%); will-change: transform; }

/* responsive */
@media (max-width:1100px){ .container { grid-template-columns: 1fr; padding:12px; } .node-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width:700px){ .node-grid { grid-template-columns: 1fr; } .charts { grid-template-columns: 1fr; } }

</style>
</head>
<body>
<!-- AUTH -->
<div class="auth-portal" id="authPortal" aria-hidden="false">
  <canvas id="authHeatmap" class="auth-heatmap"></canvas>
  <div class="auth-card light-sweep" id="authCard" role="dialog" aria-label="登录">
    <div class="auth-left">
      <div class="brand-logo" aria-hidden="true">PCDN</div>
      <div class="brand-title">流量监控平台</div>
      <div class="brand-sub">前端监控 · TDesign 深色规范</div>
      <div style="margin-top:12px;"><div class="small">安全说明：保证安全了老铁。</div></div>
    </div>
    <div class="auth-right">
      <div class="form-field">
        <label class="small">账户</label>
        <input id="loginUser" class="input" type="text" autocomplete="username" />
      </div>
      <div class="form-field">
        <label class="small">密码</label>
        <input id="loginPass" class="input" type="password" autocomplete="current-password" />
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <button id="loginBtn" class="btn-primary">登录</button>
        <button id="loginDemoBtn" class="btn-ghost">本地模式</button>
        <div id="loginError" class="small" style="color:var(--danger);display:none;"></div>
      </div>
      <div class="small" style="margin-top:6px;color:var(--text-muted);">说明：系统为前端本地化仿真，凭证以受限方式保存在脚本内。</div>
    </div>
  </div>
</div>

<!-- APP -->
<div class="container" id="appContainer" style="display:none;">
  <aside class="card sidebar" aria-label="侧边栏">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div><div style="font-weight:600;font-size:15px;">PCDN 边缘管理</div><div class="small">节点资源池与策略</div></div>
      <div style="text-align:right;"><div class="small">状态</div><div id="systemStatus" style="font-weight:600;color:var(--accent-1);">正常</div></div>
    </div>

    <div style="margin-top:12px;">
      <div style="display:flex;gap:8px;">
        <input id="newNodeInput" class="input" placeholder="输入节点名称（例如 edge-shanghai-1）" />
        <button id="addNodeBtn" class="btn-primary">添加</button>
      </div>
      <div id="quotaTooltip" style="display:none;position:relative;"></div>
    </div>

    <div style="margin-top:12px;">
      <div style="font-weight:600;margin-bottom:8px;">已注册节点</div>
      <div id="nodeList" style="display:flex;flex-direction:column;gap:8px;"></div>
    </div>

    <div style="margin-top:auto;">
      <div style="display:flex;gap:8px;">
        <button id="exportLedgerBtn" class="btn-ghost">导出收益 Ledger</button>
        <button id="emergencyBtn" class="btn-ghost" title="清除本地缓存并重载页面">紧急熔断</button>
      </div>
      <div class="small" style="margin-top:8px;color:var(--text-muted);">本地数据保存在 localStorage：pcdn_ledger</div>
    </div>
  </aside>

  <main style="display:flex;flex-direction:column;gap:12px;">
    <div class="card header" style="align-items:center;">
      <div><div class="title">运营总览</div><div class="subtitle">强约束资源池 · 实时 Telemetry · 收益熔断</div></div>
      <div style="display:flex;align-items:center;gap:12px;">
        <div id="clock" class="small">北京时间：--</div>
        <select id="currencySelect" class="input" style="width:120px;"><option value="CNY">CNY</option><option value="USD">USD</option></select>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
      <div class="card kpi light-sweep"><div class="small">今日全局预计收益</div><div id="globalRevenue" class="value" style="font-weight:600;font-size:20px;">¥0.00</div><div class="small" id="globalStatus" style="color:var(--text-muted);">累积中（每日至 00:00 重置）</div></div>
      <div class="card kpi light-sweep"><div class="small">平均每节点累计收益</div><div id="avgRevenue" class="value" style="font-weight:600;font-size:20px;">¥0.00</div><div class="small">实时累计：从零开始，24 小时内平滑增长</div></div>
      <div class="card kpi light-sweep"><div class="small">系统丢包率 (Packet Loss)</div><div id="packetLoss" class="value" style="font-weight:600;font-size:20px;">0.0%</div><div class="small">实时监测（毫秒级）</div></div>
    </div>

    <div class="charts">
      <div class="chart-card card">
        <div style="display:flex;justify-content:space-between;align-items:center;"><div style="font-weight:600;">7 日收益（Ledger）</div><div class="small">本地持久化最近 7 天记录</div></div>
        <div id="ledgerChart" style="height:260px;margin-top:12px;"></div>
      </div>

      <div style="display:flex;flex-direction:column;gap:12px;">
        <div class="card chart-card">
          <div style="display:flex;justify-content:space-between;align-items:center;"><div style="font-weight:600;">实时 Telemetry 概览</div><div class="small">Jitter / Active Connections / ISP</div></div>
          <div style="margin-top:10px;display:flex;gap:12px;align-items:center;">
            <div style="flex:1;"><div class="small">实时上行吞吐 (Mbps)</div><div id="throughput" style="font-weight:600;font-size:20px;">0 Mbps</div></div>
            <div style="flex:1;"><div class="small">活动连接数</div><div id="connections" style="font-weight:600;font-size:20px;">0</div></div>
            <div style="flex:1;"><div class="small">ISP / BGP</div><div id="ispInfo" style="font-weight:600;font-size:14px;">-</div></div>
          </div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;"><div style="font-weight:600;">HEX 审计日志流</div><div class="small">实时滚动</div></div>
          <div id="auditLog" class="log" style="margin-top:10px;"></div>
        </div>
      </div>
    </div>

    <div style="margin-top:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;"><div style="font-weight:600;">节点详情</div><div class="small">NAT / CPU / 上行吞吐 / 累计收益（当日）</div></div>
      <div class="node-grid card" id="nodeGrid" style="margin-top:12px;"></div>
    </div>
  </main>
</div>

<script>
/* ===========================================================================
   JavaScript: 完整逻辑
   - 修复登录绑定，提供更健壮处理
   - 收益从 0 -> 当日目标 在 24 小时内平滑增长；每日北京时间 00:00 重置
   - Ledger 最近 7 天持久化（localStorage）
   - Singleton 模式：TelemetryStream, GlobalRevenueController
   - Animator rAF 引擎; AuthPortal tilt & heatmap
   =========================================================================== */

/* ---------------------------
   AUTH (constants not rendered)
   --------------------------- */
const AUTH = (function(){
  const USER = 'lan123';
  const PASS = 'lan666';
  return {
    getUser: () => USER,
    getPass: () => PASS
  };
})();

/* ---------------------------
   Storage keys & defaults
   --------------------------- */
const STORAGE_KEYS = {
  LEDGER: 'pcdn_ledger',
  STATE: 'pcdn_state'
};
const DEFAULT_STATE = { nodes: [], settings: { currency: 'CNY' } };

let APP_STATE = (function(){
  try { const raw = localStorage.getItem(STORAGE_KEYS.STATE); if(raw) return JSON.parse(raw); } catch(e){}
  return JSON.parse(JSON.stringify(DEFAULT_STATE));
})();
function persistState(){ try { localStorage.setItem(STORAGE_KEYS.STATE, JSON.stringify(APP_STATE)); } catch(e){ console.warn('persist err', e); } }
function $(id){ return document.getElementById(id); }
function el(tag, cls){ const d=document.createElement(tag); if(cls) d.className=cls; return d; }
function genId(){ return 'node_' + Math.random().toString(36).slice(2,9); }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
function round2(v){ return Math.round(v*100)/100; }
function nowStr(){ return new Date().toLocaleString('zh-CN', { timeZone:'Asia/Shanghai' }); }
function todayKey(){ const d = new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai' })); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
function lastNDates(n){ const out=[]; const now=new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Shanghai' })); for(let i=n-1;i>=0;i--){ const d=new Date(now.getTime()-i*24*60*60*1000); out.push(`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`); } return out; }
function getBeijingTimeParts(){ const dtf = new Intl.DateTimeFormat('en-US', { timeZone: 'Asia/Shanghai', hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' }); const parts = dtf.formatToParts(new Date()); const obj={hour:0,minute:0,second:0}; for(const p of parts){ if(p.type==='hour') obj.hour=parseInt(p.value,10); if(p.type==='minute') obj.minute=parseInt(p.value,10); if(p.type==='second') obj.second=parseInt(p.value,10); } return obj; }
function getBeijingDayProgress(){ const parts=getBeijingTimeParts(); const seconds = parts.hour*3600 + parts.minute*60 + parts.second; return clamp(seconds/86400,0,1); }

/* ---------------------------
   Animator (rAF)
   --------------------------- */
class Animator {
  constructor(){
    this.tweens = new Set();
    this.loops = new Set();
    this._running = false;
    this._tick = this._tick.bind(this);
  }
  start(){ if(this._running) return; this._running=true; requestAnimationFrame(this._tick); }
  stop(){ this._running=false; }
  _tick(ts){
    for(const t of Array.from(this.tweens)){ try { t._update(ts); if(t._done) this.tweens.delete(t); } catch(e){ this.tweens.delete(t); } }
    for(const l of this.loops){ try { l(ts); } catch(e){} }
    if(this._running) requestAnimationFrame(this._tick);
  }
  addLoop(cb){ this.loops.add(cb); this.start(); return () => this.loops.delete(cb); }
}
function easeCubicBezier02(x){ return 1 - Math.pow(1 - x, 3); }
class Tween {
  constructor(target, prop, from, to, duration, easing, onUpdate, onComplete){
    this.target=target; this.prop=prop; this.from=from; this.to=to; this.duration=duration; this.easing=easing||easeCubicBezier02; this.onUpdate=onUpdate; this.onComplete=onComplete; this._start=null; this._done=false;
  }
  _update(ts){ if(this._start===null) this._start=ts; const t=clamp((ts-this._start)/this.duration,0,1); const eased=this.easing(t); const val=this.from + (this.to - this.from) * eased; if(this.prop && this.target) this.target.style[this.prop]=val; if(this.onUpdate) this.onUpdate(val,t); if(t>=1){ this._done=true; if(this.onComplete) this.onComplete(); } }
}
const ANIMATOR = new Animator();

/* ---------------------------
   TelemetryStream Singleton
   --------------------------- */
class TelemetryStream {
  constructor(){ if(TelemetryStream._instance) return TelemetryStream._instance; this.subscribers=new Set(); this.nodes=[]; this.timer=null; this._running=false; TelemetryStream._instance=this; return this; }
  static instance(){ return new TelemetryStream(); }
  attachNodes(nodes){ this.nodes = nodes; }
  start(interval=800){ if(this._running) return; this._running=true; this.timer=setInterval(()=>this._tick(), interval); this._tick(); }
  stop(){ if(this.timer) clearInterval(this.timer); this.timer=null; this._running=false; }
  subscribe(cb){ this.subscribers.add(cb); return () => this.subscribers.delete(cb); }
  _tick(){ const timestamp=Date.now(); const totalThroughput=this.nodes.reduce((s,n)=>s+(n.upMbps||0),0); const jitterMs=Math.abs(this._gauss(0,18)); const packetLoss=clamp(Math.abs(this._gauss(0,0.6)),0,5); const activeConnections=Math.max(0,Math.round(this._gauss(1200,400))); const ispDistribution=this._ispSummary(); const nodeUpdates=this.nodes.map(n=>({ id:n.id, name:n.name, cpu:clamp(Math.round(n.cpu + this._gauss(0,3)),1,99), upMbps: Math.max(0, Math.round(n.upMbps + this._gauss(0,20))), activeConnections: n.activeConnections || Math.round(200 + Math.random()*800) })); const payload={ ts: timestamp, jitterMs: round2(jitterMs), packetLoss: round2(packetLoss), throughput: Math.round(totalThroughput), activeConnections, ispDistribution, nodes: nodeUpdates }; for(const s of Array.from(this.subscribers)) try{ s(payload); } catch(e){} }
  _gauss(mean=0,std=1){ let u=0,v=0; while(u===0) u=Math.random(); while(v===0) v=Math.random(); const z=Math.sqrt(-2.0*Math.log(u))*Math.cos(2.0*Math.PI*v); return z*std+mean; }
  _ispSummary(){ const carriers=['移动','电信','联通','广电']; const counts=carriers.map(()=>Math.max(1,Math.round(Math.random()*5))); const total=counts.reduce((a,b)=>a+b,0); return carriers.map((c,i)=>({isp:c,pct:round2((counts[i]/total)*100)})); }
}

/* ---------------------------
   GlobalRevenueController Singleton
   - daily targets per node within [60,105]
   - global cap 320
   - computes targets and realtime accumulated value based on Beijing day progress
   - persists ledger of last 7 days in STORAGE_KEYS.LEDGER
   --------------------------- */
class GlobalRevenueController {
  constructor(){ if(GlobalRevenueController._instance) return GlobalRevenueController._instance; this.nodes=[]; this.ledger=this._loadLedger(); this.maxTotal=320.00; this.nodeMin=60.00; this.nodeMax=105.00; this.smoothing={}; GlobalRevenueController._instance=this; return this; }
  static instance(){ return new GlobalRevenueController(); }
  attachNodes(nodes){ this.nodes = nodes || []; for(const n of this.nodes) if(!this.smoothing[n.id]) this.smoothing[n.id] = { targetVal: (this.nodeMin+this.nodeMax)/2, currentAccum: 0 }; }
  _computeDailyTargets(){ const n=this.nodes.length; if(n===0) return { targets:[], totalTarget:0 }; const rawTargets=this.nodes.map(node=>{ const base=this._pseudoRandomForNode(node.id); const t=this.nodeMin + base*(this.nodeMax - this.nodeMin); const jitter=(Math.random()-0.5)*4.0; return clamp(round2(t + jitter), this.nodeMin, this.nodeMax); }); let sum = rawTargets.reduce((a,b)=>a+b,0); if(sum <= this.maxTotal){ const smoothed = rawTargets.map((v,idx)=>{ const s=this.smoothing[this.nodes[idx].id]||{targetVal:v}; const newVal = s.targetVal + (v - s.targetVal) * 0.12; s.targetVal = round2(newVal); return s.targetVal; }); return { targets: smoothed, totalTarget: round2(smoothed.reduce((a,b)=>a+b,0)) }; } else { const attenuation = Math.max(0.0001, this.maxTotal / sum); const adjusted = rawTargets.map(v => clamp(round2(v * attenuation), this.nodeMin, this.nodeMax)); let finalSum = adjusted.reduce((a,b)=>a+b,0); if(finalSum > this.maxTotal){ const prop = this.maxTotal / finalSum; for(let i=0;i<adjusted.length;i++) adjusted[i]= round2(adjusted[i]*prop); finalSum = adjusted.reduce((a,b)=>a+b,0); } const smoothed = adjusted.map((v,idx)=>{ const s=this.smoothing[this.nodes[idx].id]||{targetVal:v}; const newVal = s.targetVal + (v - s.targetVal) * 0.14; s.targetVal = round2(newVal); return s.targetVal; }); return { targets: smoothed, totalTarget: round2(smoothed.reduce((a,b)=>a+b,0)) }; } }
  computeRealtimeDistribution(){ const dayProgress = getBeijingDayProgress(); const { targets, totalTarget } = this._computeDailyTargets(); const accumulatedPerNode = targets.map((t, idx)=>{ const prev = (this.smoothing[this.nodes[idx].id] && this.smoothing[this.nodes[idx].id].currentAccum) || 0; const desired = round2(t * dayProgress); const newAccum = round2(prev + (desired - prev) * 0.22 + (Math.random()-0.5) * 0.04); const bounded = clamp(newAccum, 0, t); this.smoothing[this.nodes[idx].id].currentAccum = round2(bounded); return round2(bounded); }); const totalAccumulated = round2(accumulatedPerNode.reduce((a,b)=>a+b,0)); return { totalTarget, targets, totalAccumulated, accumulatedPerNode, progress: dayProgress }; }
  _loadLedger(){ try{ const raw=localStorage.getItem(STORAGE_KEYS.LEDGER); if(raw) return JSON.parse(raw); } catch(e){} const dates = lastNDates(7); const ledger = dates.map(d=>({date:d, total:0.00})); localStorage.setItem(STORAGE_KEYS.LEDGER, JSON.stringify(ledger)); return ledger; }
  _saveLedger(){ try{ localStorage.setItem(STORAGE_KEYS.LEDGER, JSON.stringify(this.ledger)); } catch(e){} }
  pushTodaySnapshot(totalAccumulated){ const key = todayKey(); const idx = this.ledger.findIndex(r=>r.date===key); if(idx>=0) this.ledger[idx].total = round2(totalAccumulated); else { this.ledger.push({date:key,total:round2(totalAccumulated)}); if(this.ledger.length>7) this.ledger.shift(); } this._saveLedger(); }
  getLedger(){ return this.ledger.slice(); }
  _pseudoRandomForNode(nid){ let h = 2166136261 >>> 0; for(let i=0;i<nid.length;i++){ h ^= nid.charCodeAt(i); h = Math.imul(h, 16777619); } return ((h >>> 0) % 1000) / 999; }
}

/* ---------------------------
   AuthPortal (Tilt + Heatmap)
   --------------------------- */
class AuthPortal {
  constructor(){ this.card = $('authCard'); this.heatmap = $('authHeatmap'); this._tiltState={rx:0,ry:0}; this._init(); }
  _init(){ this._resizeCanvas(); window.addEventListener('resize', ()=> this._resizeCanvas()); this._initHeatPoints(36); this._heatLoop = this._heatLoop.bind(this); requestAnimationFrame(this._heatLoop); this._onMouseMove = this._onMouseMove.bind(this); this.card.addEventListener('mousemove', this._onMouseMove); this.card.addEventListener('mouseleave', ()=>{ const el=this.card; let start=performance.now(); const dur=650; const srx=this._tiltState.rx||0; const sry=this._tiltState.ry||0; const tick=(ts)=>{ const t=clamp((ts-start)/dur,0,1); const eased=easeCubicBezier02(t); const rx = srx * (1 - eased); const ry = sry * (1 - eased); el.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(0px)`; if(t<1) requestAnimationFrame(tick); else { this._tiltState.rx=0; this._tiltState.ry=0; el.style.transform='perspective(900px) rotateX(0deg) rotateY(0deg) translateZ(0px)'; } }; requestAnimationFrame(tick); }); }
  _resizeCanvas(){ const c=this.heatmap; const dpr=window.devicePixelRatio||1; c.width = Math.floor(c.clientWidth * dpr); c.height = Math.floor(c.clientHeight * dpr); this._ctx=c.getContext('2d'); this._ctx.setTransform(dpr,0,0,dpr,0,0); }
  _initHeatPoints(n){ this.heatPoints=[]; for(let i=0;i<n;i++) this.heatPoints.push({ x:Math.random()*this.heatmap.clientWidth, y:Math.random()*this.heatmap.clientHeight, vx:(Math.random()-0.5)*0.7, vy:(Math.random()-0.5)*0.7, amp:24+Math.random()*72 }); }
  _heatLoop(){ const ctx=this._ctx; if(!ctx){ requestAnimationFrame(()=>this._heatLoop()); return; } const w=this.heatmap.clientWidth, h=this.heatmap.clientHeight; ctx.clearRect(0,0,w,h); ctx.fillStyle='rgba(3,6,10,0.5)'; ctx.fillRect(0,0,w,h); for(const p of this.heatPoints){ p.x+=p.vx; p.y+=p.vy; if(p.x < -50) p.x = w + 50; if(p.x > w + 50) p.x = -50; if(p.y < -50) p.y = h + 50; if(p.y > h + 50) p.y = -50; const g = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.amp); g.addColorStop(0,'rgba(173,219,255,0.14)'); g.addColorStop(0.3,'rgba(96,165,250,0.06)'); g.addColorStop(1,'rgba(0,0,0,0)'); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(p.x,p.y,p.amp,0,Math.PI*2); ctx.fill(); } requestAnimationFrame(()=>this._heatLoop()); }
  _onMouseMove(e){ const rect=this.card.getBoundingClientRect(); const cx = rect.left + rect.width/2; const cy = rect.top + rect.height/2; const dx = e.clientX - cx; const dy = e.clientY - cy; const rx = clamp(-dy / rect.height * 10, -10, 10); const ry = clamp(dx / rect.width * 10, -10, 10); this._tiltState.rx = rx; this._tiltState.ry = ry; this.card.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(6px)`; }
}

/* ---------------------------
   AuditLog
   --------------------------- */
class AuditLog {
  constructor(container){ this.container=container; this.entries=[]; this._timer=null; }
  start(){ if(this._timer) return; this._timer = setInterval(()=>this._push(),900); this._push(); }
  stop(){ if(this._timer) clearInterval(this._timer); this._timer=null; }
  clear(){ this.entries=[]; this._render(); }
  _push(){ const hex = Array.from({length:32}).map(()=> Math.floor(Math.random()*16).toString(16)).join(''); const level = Math.random() > 0.995 ? 'ERROR' : (Math.random() > 0.98 ? 'WARN' : 'INFO'); const ts = nowStr(); const text = `[${ts}] [${level}] ${hex}`; this.entries.unshift(text); if(this.entries.length>300) this.entries.length=300; this._render(); }
  _render(){ if(!this.container) return; this.container.innerHTML = this.entries.map(e=>`<div style="padding:4px 0;">${e}</div>`).join(''); }
}

/* ---------------------------
   NodeManager
   --------------------------- */
class NodeManager {
  constructor(gridEl, listEl){ this.gridEl=gridEl; this.listEl=listEl; this.nodes = APP_STATE.nodes || []; this._renderAll(); }
  addNode(name){ if(this.nodes.length >= 5) return {ok:false,msg:'资源配额已达上限（5/5）'}; if(!name||!name.trim()) return {ok:false,msg:'名称不能为空'}; if(this.nodes.some(n=>n.name.toLowerCase()===name.toLowerCase())) return {ok:false,msg:'节点名称重复'}; const node = { id:genId(), name:name.trim(), nat: Math.random()>0.5?'Cone':'Symmetric', cpu: Math.round(12+Math.random()*45), upMbps: Math.round(20+Math.random()*300), isp: ['移动','电信','联通','广电'][Math.floor(Math.random()*4)], activeConnections: Math.round(200 + Math.random()*1200) }; this.nodes.push(node); APP_STATE.nodes = this.nodes; persistState(); this._renderAll(); return {ok:true,node}; }
  removeNode(id){ this.nodes = this.nodes.filter(n=>n.id!==id); APP_STATE.nodes=this.nodes; persistState(); this._renderAll(); }
  editNode(id,newName){ const node=this.nodes.find(n=>n.id===id); if(!node) return; node.name=newName; persistState(); this._renderAll(); }
  updateNodes(nodes){ for(const update of nodes){ const node=this.nodes.find(n=>n.id===update.id); if(node){ node.cpu=update.cpu; node.upMbps=update.upMbps; node.activeConnections=update.activeConnections||node.activeConnections; } } this._refreshGridMetrics(); }
  _renderAll(){ this.listEl.innerHTML=''; for(const n of this.nodes){ const row=el('div',''); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.padding='8px'; row.style.borderRadius='8px'; row.style.border='0.5px solid rgba(255,255,255,0.03)'; row.style.background='linear-gradient(180deg, rgba(255,255,255,0.008), rgba(255,255,255,0.004))'; const left=el('div',''); left.innerHTML = `<div style="font-weight:600;">${escapeHtml(n.name)}</div><div class="small">${n.isp} · NAT:${n.nat}</div>`; const right=el('div',''); right.innerHTML = `<button class="small-btn" data-edit="${n.id}" style="margin-right:6px;">编辑</button><button class="small-btn" data-remove="${n.id}">删除</button>`; row.appendChild(left); row.appendChild(right); this.listEl.appendChild(row); } this._renderGrid(); const addBtn = $('addNodeBtn'); if(this.nodes.length>=5){ addBtn.classList.add('btn-disabled'); addBtn.disabled = true; showQuotaTooltip(addBtn,'资源配额已达上限（5/5）'); } else { addBtn.classList.remove('btn-disabled'); addBtn.disabled=false; hideQuotaTooltip(); } this.listEl.querySelectorAll('[data-edit]').forEach(b=>b.addEventListener('click', (e)=>{ const id=e.currentTarget.getAttribute('data-edit'); const node=this.nodes.find(x=>x.id===id); const newName = prompt('编辑节点名称', node?node.name:''); if(newName && newName.trim()) this.editNode(id,newName.trim()); })); this.listEl.querySelectorAll('[data-remove]').forEach(b=>b.addEventListener('click',(e)=>{ const id=e.currentTarget.getAttribute('data-remove'); if(confirm('确认删除该节点？')) this.removeNode(id); })); }
  _renderGrid(){ this.gridEl.innerHTML=''; if(this.nodes.length===0){ const p=el('div','small'); p.innerText='当前无节点，请添加节点开始监控。'; this.gridEl.appendChild(p); return; } const revenueCtrl = GlobalRevenueController.instance(); revenueCtrl.attachNodes(this.nodes); const dist = revenueCtrl.computeRealtimeDistribution(); for(let i=0;i<this.nodes.length;i++){ const n=this.nodes[i]; const card=el('div','node-card'); card.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;"><div style="font-weight:600;">${escapeHtml(n.name)}</div><div style="text-align:right;"><div style="font-weight:700;">${formatMoney(dist.accumulatedPerNode[i]||0, APP_STATE.settings.currency)}</div><div class="small">当日累计</div></div></div><div style="display:flex;gap:12px;align-items:center;"><div style="flex:1;"><div class="small">NAT: <span style="font-weight:600;">${n.nat}</span> · ISP: <span style="font-weight:600;">${n.isp}</span></div><div style="margin-top:8px;" class="small">CPU</div><div class="progress" style="margin-top:6px;"><i style="width:${n.cpu}%"></i></div></div><div style="width:150px;"><div class="small">上行</div><div style="font-weight:700;">${n.upMbps} Mbps</div><div class="small">Conn: ${n.activeConnections}</div></div></div><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px;"><button class="small-btn" data-edit="${n.id}">编辑</button><button class="small-btn" data-remove="${n.id}">删除</button></div>`; this.gridEl.appendChild(card); } this.gridEl.querySelectorAll('[data-edit]').forEach(b=>b.addEventListener('click',(e)=>{ const id=e.currentTarget.getAttribute('data-edit'); const node=this.nodes.find(x=>x.id===id); const newName=prompt('编辑节点名称', node?node.name:''); if(newName && newName.trim()) this.editNode(id,newName.trim()); })); this.gridEl.querySelectorAll('[data-remove]').forEach(b=>b.addEventListener('click',(e)=>{ const id=e.currentTarget.getAttribute('data-remove'); if(confirm('确认删除该节点？')) this.removeNode(id); })); }
  _refreshGridMetrics(){ const cards = this.gridEl.querySelectorAll('.node-card'); for(const card of cards){ const title = card.querySelector('div[style*="font-weight:600;"]'); if(!title) continue; const name=title.innerText.trim(); const node=this.nodes.find(n=>n.name===name); if(!node) continue; const bar=card.querySelector('.progress > i'); if(bar) bar.style.width = node.cpu + '%'; const upText = card.querySelector('div[style*="font-weight:700;"]'); if(upText) upText.innerText = `${node.upMbps} Mbps`; } }
}

/* ---------------------------
   Tooltip helpers
   --------------------------- */
let _tooltipEl = null;
function showQuotaTooltip(targetEl, text){ hideQuotaTooltip(); _tooltipEl = el('div','tooltip'); _tooltipEl.innerText = text; document.body.appendChild(_tooltipEl); const rect = targetEl.getBoundingClientRect(); _tooltipEl.style.left = (rect.left + rect.width/2 - (_tooltipEl.offsetWidth/2)) + 'px'; _tooltipEl.style.top = (rect.top - _tooltipEl.offsetHeight - 8) + 'px'; }
function hideQuotaTooltip(){ if(_tooltipEl){ _tooltipEl.remove(); _tooltipEl=null; } }

/* ---------------------------
   Ledger Chart (echarts)
   --------------------------- */
let ledgerChart = null;
function initLedgerChart(){ const dom=$('ledgerChart'); ledgerChart = echarts.init(dom); const opt = { tooltip:{trigger:'axis', formatter: params => { const p=params[0]; return `${p.axisValue}<br/>收益: ${formatMoney(p.data, APP_STATE.settings.currency)}`; } }, xAxis:{type:'category', data:[]}, yAxis:{type:'value', axisLabel:{formatter: val => formatMoney(val, APP_STATE.settings.currency)}}, series:[{type:'bar', data:[], itemStyle:{color:'#60a5fa'}}] }; ledgerChart.setOption(opt); }
function updateLedgerChart(){ try{ const gr = GlobalRevenueController.instance(); const ledger = gr.getLedger(); const dates = ledger.map(r => r.date.slice(5)); const vals = ledger.map(r => r.total); if(ledgerChart) ledgerChart.setOption({ xAxis:{data:dates}, series:[{data:vals}] }); } catch(e){} }

/* ---------------------------
   Periodic orchestration & UI update
   --------------------------- */
let telemetry = TelemetryStream.instance();
let auditLog = null;
let nodeManager = null;
let revenueController = GlobalRevenueController.instance();
let animatorStarted = false;

function onTelemetryUpdate(payload){
  $('throughput').innerText = payload.throughput + ' Mbps';
  $('connections').innerText = payload.activeConnections;
  $('packetLoss').innerText = payload.packetLoss + '%';
  const isp = payload.ispDistribution && payload.ispDistribution.length ? payload.ispDistribution.map(i=>`${i.isp} ${i.pct}%`).join(' · ') : '-';
  $('ispInfo').innerText = isp;
  const parts = payload.nodes.map(n=>`${n.name}:${n.upMbps}Mbps/${n.cpu}%`);
  auditLog.entries.unshift(`[${nowStr()}] TELEMETRY ${parts.join(' | ')}`);
  if(auditLog.entries.length>300) auditLog.entries.length=300;
  auditLog._render();
  if(nodeManager){ const updates = payload.nodes.map(u=>({ id:u.id, name:u.name, cpu:u.cpu, upMbps:u.upMbps, activeConnections:u.activeConnections||0 })); nodeManager.updateNodes(updates); }
  revenueController.attachNodes(APP_STATE.nodes || []);
  const dist = revenueController.computeRealtimeDistribution();
  $('globalRevenue').innerText = formatMoney(dist.totalAccumulated, APP_STATE.settings.currency);
  $('avgRevenue').innerText = APP_STATE.nodes && APP_STATE.nodes.length ? formatMoney(dist.totalAccumulated / APP_STATE.nodes.length, APP_STATE.settings.currency) : formatMoney(0, APP_STATE.settings.currency);
  revenueController.pushTodaySnapshot(dist.totalAccumulated);
  updateLedgerChart();
}

/* ---------------------------
   Export CSV, emergency
   --------------------------- */
function exportLedgerCSV(){ const gr = GlobalRevenueController.instance(); const ledger = gr.getLedger(); let csv = '日期,总收益\n'; for(const r of ledger) csv += `${r.date},${r.total}\n`; const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download = `pcdn_ledger_${ledger[0].date}_to_${ledger[ledger.length-1].date}.csv`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }
function emergencyReset(){ if(!confirm('确定执行紧急熔断？这将清除本地缓存并重载页面。')) return; localStorage.removeItem(STORAGE_KEYS.STATE); localStorage.removeItem(STORAGE_KEYS.LEDGER); sessionStorage.removeItem('pcdn_logged'); location.reload(); }

/* ---------------------------
   startApp (called after successful login)
   --------------------------- */
function startApp(){
  $('appContainer').style.display = 'grid';
  initLedgerChart();
  updateLedgerChart();
  auditLog = new AuditLog($('auditLog'));
  auditLog.start();
  nodeManager = new NodeManager($('nodeGrid'), $('nodeList'));
  telemetry.attachNodes(APP_STATE.nodes || []);
  telemetry.subscribe(onTelemetryUpdate);
  telemetry.start(900);
  $('exportLedgerBtn').addEventListener('click', exportLedgerCSV);
  $('addNodeBtn').addEventListener('click', ()=>{ const name = $('newNodeInput').value.trim(); const res = nodeManager.addNode(name); if(!res.ok){ showQuotaTooltip($('addNodeBtn'), res.msg); setTimeout(hideQuotaTooltip, 2500); } else { $('newNodeInput').value=''; telemetry.attachNodes(APP_STATE.nodes || []); } });
  $('emergencyBtn').addEventListener('click', ()=>{ if(!confirm('执行紧急熔断将清除本地缓存并重载页面，是否继续？')) return; try{ localStorage.removeItem(STORAGE_KEYS.STATE); localStorage.removeItem(STORAGE_KEYS.LEDGER); } catch(e){} location.reload(); });
  startClock();
  startLightSweepAnimation();
  if(!animatorStarted){ ANIMATOR.start(); animatorStarted=true; }
  const gr = GlobalRevenueController.instance();
  gr.attachNodes(APP_STATE.nodes || []);
  const snapshot = gr.computeRealtimeDistribution();
  gr.pushTodaySnapshot(snapshot.totalAccumulated);
  updateLedgerChart();
  scheduleMidnightReset();
}

/* ---------------------------
   Light sweep animation
   --------------------------- */
function startLightSweepAnimation(){ const targets = document.querySelectorAll('.light-sweep'); targets.forEach(elm=>{ const overlay = document.createElement('div'); overlay.style.position='absolute'; overlay.style.inset='0'; overlay.style.pointerEvents='none'; overlay.style.background='linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.06) 45%, rgba(255,255,255,0) 70%)'; overlay.style.mixBlendMode='overlay'; overlay.style.opacity='0.06'; overlay.style.transform='translateX(-120%)'; overlay.style.borderRadius='inherit'; overlay.style.willChange='transform'; overlay.className='light-overlay'; elm.style.position='relative'; elm.appendChild(overlay); const speed = 2200 + Math.random()*1200; let start = performance.now(); const loop = (ts)=>{ const t = ((ts - start) % speed) / speed; const eased = easeCubicBezier02(t); const x = (eased * 240) - 120; overlay.style.transform = `translateX(${x}%)`; }; ANIMATOR.addLoop(loop); }); }

/* ---------------------------
   Clock
   --------------------------- */
let _clockTimer = null;
function startClock(){ if(_clockTimer) clearInterval(_clockTimer); function tick(){ const now = new Date().toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' }); if($('clock')) $('clock').innerText = '北京时间：' + now; } tick(); _clockTimer = setInterval(tick, 1000); }

/* ---------------------------
   Ledger chart helper
   --------------------------- */
function updateLedgerChart(){ try{ const gr = GlobalRevenueController.instance(); const ledger = gr.getLedger(); const dates = ledger.map(r=>r.date.slice(5)); const vals = ledger.map(r=>r.total); if(ledgerChart) ledgerChart.setOption({ xAxis:{data:dates}, series:[{data:vals}] }); } catch(e){} }

/* ---------------------------
   scheduleMidnightReset (Beijing midnight)
   --------------------------- */
let _midnightTimer = null;
function scheduleMidnightReset(){ if(_midnightTimer) clearInterval(_midnightTimer); _midnightTimer = setInterval(()=>{ try{ const now = new Date(new Date().toLocaleString('en-US', { timeZone:'Asia/Shanghai' })); const hour = now.getHours(); const minute = now.getMinutes(); const second = now.getSeconds(); if(hour===0 && minute===0 && second<5){ const gr = GlobalRevenueController.instance(); gr.attachNodes(APP_STATE.nodes || []); const finalDist = gr.computeRealtimeDistribution(); gr.pushTodaySnapshot(finalDist.totalAccumulated); for(const nid in gr.smoothing) if(gr.smoothing[nid]) gr.smoothing[nid].currentAccum = 0; updateLedgerChart(); } } catch(e){} }, 10000); }

/* ---------------------------
   Utility functions
   --------------------------- */
function formatMoney(v, cur='CNY'){ if(cur==='USD') return '$' + Number(v).toFixed(2); return '¥' + Number(v).toFixed(2); }
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ---------------------------
   Robust login binding (replacement)
   - Ensures bindings occur and supports Enter key
   - Logs debug info (no plaintext password) to console to aid troubleshooting
   --------------------------- */
(function bindLoginHandlers(){
  function setup(){
    const loginBtn = $('loginBtn');
    const demoBtn = $('loginDemoBtn');
    const userInput = $('loginUser');
    const passInput = $('loginPass');
    const loginError = $('loginError');

    if(!loginBtn || !userInput || !passInput){
      console.error('[Login] required DOM elements not found.');
      return;
    }

    function doLogin(){
      const u = userInput.value ? userInput.value.trim() : '';
      const p = passInput.value ? passInput.value : '';
      console.debug('[LoginAttempt] user="%s", passLen=%d', u, p.length);

      if(u === AUTH.getUser() && p === AUTH.getPass()){
        sessionStorage.setItem('pcdn_logged','1');
        const authPortal = $('authPortal');
        const appContainer = $('appContainer');
        if(authPortal) authPortal.style.display = 'none';
        if(appContainer) appContainer.style.display = 'grid';
        if(typeof startApp === 'function'){
          try { startApp(); } catch(e){ console.error('startApp() error', e); }
        }
        if(loginError) loginError.style.display = 'none';
      } else {
        if(loginError){ loginError.style.display = 'block'; loginError.innerText = '账号或密码错误'; }
      }
    }

    loginBtn.addEventListener('click', doLogin);
    if(demoBtn) demoBtn.addEventListener('click', () => {
      if(!APP_STATE.nodes || APP_STATE.nodes.length === 0){
        APP_STATE.nodes = [
          { id: genId(), name: 'edge-shanghai-01', nat:'Cone', cpu:30, upMbps:120, isp:'电信', activeConnections:420 },
          { id: genId(), name: 'edge-beijing-01', nat:'Symmetric', cpu:36, upMbps:240, isp:'移动', activeConnections:680 },
          { id: genId(), name: 'edge-guangzhou-01', nat:'Cone', cpu:28, upMbps:160, isp:'联通', activeConnections:420 }
        ];
        persistState();
      }
      sessionStorage.setItem('pcdn_logged','1');
      const authPortal = $('authPortal');
      const appContainer = $('appContainer');
      if(authPortal) authPortal.style.display = 'none';
      if(appContainer) appContainer.style.display = 'grid';
      if(typeof startApp === 'function'){
        try { startApp(); } catch(e){ console.error('startApp() error', e); }
      }
    });

    [userInput, passInput].forEach(inp => {
      inp.addEventListener('keydown', (ev) => { if(ev.key === 'Enter') doLogin(); });
    });

    if(sessionStorage.getItem('pcdn_logged') === '1'){
      const authPortal = $('authPortal');
      const appContainer = $('appContainer');
      if(authPortal) authPortal.style.display = 'none';
      if(appContainer) appContainer.style.display = 'grid';
      if(typeof startApp === 'function'){
        try { startApp(); } catch(e){ console.error('startApp() error', e); }
      }
    }
  }

  // if DOM already ready, run; else wait
  if(document.readyState === 'complete' || document.readyState === 'interactive') setTimeout(setup, 10);
  else document.addEventListener('DOMContentLoaded', setup);
})();

/* ---------------------------
   Initialize AuthPortal heatmap & minimal UI polish
   --------------------------- */
(function initAuthPortal(){
  try { new AuthPortal(); } catch(e){ console.warn('AuthPortal init err', e); }
})();

/* ---------------------------
   Ensure ledger chart resizes on window resize
   --------------------------- */
window.addEventListener('resize', () => { try { if(ledgerChart) ledgerChart.resize(); } catch(e){} });

/* ============================
   End of script
   - If login still fails: open DevTools Console and look for console.debug LoginAttempt lines and any errors.
   ============================ */
</script>
</body>
</html>
